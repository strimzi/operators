// Module included in the following assemblies:
//
// managing/assembly-rolling-updates.adoc

[id='proc-manual-rolling-update-pods-{context}']
= Performing a rolling update using a pod annotation

This procedure describes how to manually trigger a rolling update of an existing Kafka, Connect, MirrorMaker2, or ZooKeeper clusters using a Kubernetes `Pod` annotation.
When multiple pods are annotated, consecutive rolling updates are performed within the same reconciliation run.

.Prerequisites

To perform a manual rolling update, you need a running Cluster Operator and Kafka, Connect, or MirrorMaker2 cluster.

You can perform a rolling update on a Kafka cluster regardless of the topic replication factor used.
But for Kafka to stay operational during the update, you'll need the following:

* A highly available Kafka cluster deployment running with nodes that you wish to update.
* Topics replicated for high availability.
+
Topic configuration specifies a replication factor of at least 3 and a minimum number of in-sync replicas to 1 less than the replication factor.
+
.Kafka topic replicated for high availability
[source,yaml,subs="attributes+"]
----
apiVersion: {KafkaTopicApiVersion}
kind: KafkaTopic
metadata:
  name: my-topic
  labels:
    strimzi.io/cluster: my-cluster
spec:
  partitions: 1
  replicas: 3
  config:
    # ...
    min.insync.replicas: 2
    # ...
----

.Procedure

. Find the name of the `Pod` you want to manually update.
+
For example, if your Kafka cluster is named _my-cluster_, the corresponding `Pod` names are _my-cluster-kafka-index_ and _my-cluster-zookeeper-index_.
For Connect cluster named _my-connect_, the corresponding `Pod` name is _my-connect-connect-index_.
And for MirrorMaker 2 cluster named _my-mm2_, the corresponding `Pod` name is _my-mm2-mirrormaker2-index_.
The _index_ will be a number assigned to the `Pod`.

. Annotate the `Pod` resource in Kubernetes.
+
Use `kubectl annotate`:
+
[source,shell,subs=+quotes]
----
kubectl annotate pod _cluster-name_-kafka-_index_ strimzi.io/manual-rolling-update=true

kubectl annotate pod _cluster-name_-zookeeper-_index_ strimzi.io/manual-rolling-update=true

kubectl annotate pod _cluster-name_-connect-_index_ strimzi.io/manual-rolling-update=true

kubectl annotate pod _cluster-name_-mirrormaker2-_index_ strimzi.io/manual-rolling-update=true
----

. Wait for the next reconciliation to occur (every two minutes by default).
A rolling update of the annotated `Pod` is triggered, as long as the annotation was detected by the reconciliation process.
When the rolling update of a pod is complete, the annotation is automatically removed from the `Pod`.
